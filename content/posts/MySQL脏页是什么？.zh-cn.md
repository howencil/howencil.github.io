---
title: "MySQL脏页是什么？"
date: 2022-06-09T14:14:09+08:00
draft: false
author: 插画师
tags: ["MySQL"]
categories: ["Tech"]
---

# 1.MySQL脏页

- 干净页：内存和磁盘中的数据一致。
- 脏页：内存和磁盘中的数据不一致。

# 2.为什么会出现脏页

**平时很快的更新操作，都是写在内存和日志。并不会马上同步到磁盘数据页，此时内存数据页和磁盘数据页内容不一致，我们称之为脏页。**

# 3.为什么脏页一定要刷新

- 数据只放在缓冲区，会出现==数据库宕机，内存数据丢失==。
- `redo log`如果无限大或者有许多个文件的话，系统中有大量的修改操作，一旦宕机，恢复时间也会非常长。

所以自然而然，我们就一定**需要把内存中的脏页按照某种规则刷新到磁盘中**，有了这个刷新操作，缓冲区的大小问题和`redo log`的大小问题都可以得到解决。

- 缓冲区不需要无限大了，因为可以持久化到磁盘。
- `redo log`也不需要无限大了，因为一定持久化到磁盘，`redo log`中对应的那部分就可以释放。

# 4.刷脏页有下面4种场景

1. 当`redo log` 写满，`MySQL`就会暂停所有更新操作，将同步这部分的日志对应的脏页同步到磁盘。
2. 系统内存不足时，需要淘汰一部分数据页，如果淘汰的是脏页，就要先脏页同步到磁盘。
3. `MySQL`认为系统空闲时，有机会就同步内存数据到磁盘，这种没有性能问题。
4. `MySQL`正常关闭，`MySQL`会把内存脏页都同步到磁盘上，这样下次`MySQL`启动时，就可以直接从磁盘上读取数据，启动数据很快。这种没有性能问题。

# 5.会造成的影响

**要尽量避免`redo log`写满，否则整个系统的更新都会停止。此时写的性能为0，必须等待该日志对应的脏页同步完成后，才能继续更新操作，此时就会导致`SQL`语句执行得很慢。**

# 6.如何刷新

**在`InnoDB`中有两种刷新规则，称为`checkpoint` 。**

- `sharp checkpoint`：在数据库关闭时，刷新所有脏页到磁盘，这里的有参数控制，默认是开启的。
- `fuzzy checkpoint`：刷新一部分脏页到磁盘中。

> 参考文章：[什么是MySQL脏页](https://www.modb.pro/db/71045)
