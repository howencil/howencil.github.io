---
title: "Redis汇总"
date: 2022-06-20T15:36:25+08:00
draft: false
author: 插画师
tags: ["Redis"]
categories: ["Tech"]
---
# 1.什么是Redis
`Redis`是一个key-value类型的内存数据库吗，整个数据库系统加载在内存中进行操作，并定期通过异步操作把数据库数据`flush`到硬盘上进行保存。

# 2.Redis的数据类型
1. stirng: **字符串**
2. list: **可重复的集合**
3. set: **不可重复的集合**
4. hash: **类似Map<String,String>**
5. zset: **可以排序的set**

# 3.一个字符串类型的value能存储的最大容量是多少
512MB

# 4.怎么理解Redis事务？
`Redis`无法做到关系型数据库（诸如MySQL）一样严格的ACID属性。

为了效率，`Redis`舍弃了事务控制过程中的回滚支持。

一个队列中的多个命令除非是在加入队列时发现错误会做到整个事务都不执行，否则所有命令都会执行，哪怕是队列中有的命令会执行失败。

在配合`wacth`命令后，`Redis`的事务可以实现乐观锁的效果：一个队列中的命令在执行时如果检测到碰撞，则放弃自己的操作。
> 关于watch命令：watch命令可以监控一个或多个键，一旦其中一个键被修改或删除，之后的事务就不会执行。监控一直持续到exec命令（事务中的命令是在exec之后才执行的，所以multi命令可以修改watch监控的键值）。

# 5.Redis事务相关的命令有哪几个？过期时间和永久有效如何设置？
1. 事务相关的命令：
`multi`，
`exec`，
`discard`，
`watch`
2. 过期时间和永久有效：
`expire`和`persist`

# 6.Redis缓存怎么做扩容？
如果`Redis`被当做缓存使用，使用一致性哈希实现动态扩容缩容。

# 7.为什么Redis需要把所有数据放到内存中？
`Redis`为了达到最快的读写速度将数据都读到内存中，并通过异步的方式将数据写入磁盘。所以`Redis`具有快速和数据持久化的特征。如果不将数据放在内存中，磁盘I/O速度将会严重影响`Redis`的性能。

如果设置了最大使用内存，则数据已有记录数达到内存限值后，不能继续插入新的值。

# 8.Redis如何做到内存优化？
尽可能使用散列表（hashes)，散列表使用的内存非常小，所以应该尽可能地将你的数据模型抽象到一个散列表里。比如一个用户对象，不要为这个用户的名字、姓氏、邮箱、密码设置单独的`key`，而是应该把这个用户的所有信息存储到一张散列表里面。

# 9.缓存穿透、缓存击穿、缓存雪崩是什么？以及解决方案
1. 缓存穿透：**数据库和缓存都不存在的数据，被大量请求。**
   - **解决方案：** 
     - 1.对空数据进行缓存。
     - 2.使用布隆过滤器。将可能存在的数据`hash`到`bitmap`中，`bitmap`证明该数据不存在则该数据一定不存在；`bitmap`证明改数据存在也只能证明该数据可能存在。该方案只能做到降低发生的概率，无法完全避免。
2. 缓存击穿：**一个被大量请求的数据，缓存突然失效，导致该大量请求直接请求到数据库，造成数据库压力剧增。**
    - **解决方案：** 
      - 1.如果是热点数据，可以设置永不过期。
      - 2.如果数据一定会过期，那可以使用互斥锁，一次只能通过一个请求。
3. 缓存雪崩：**缓存中大量的数据，在同一个时间点、或者较短时间内，全部过期了，导致请求直接请求到数据库，导致数据库压力剧增。**
   - **解决方案：** 
     - 1.如果是热点数据，可以设置永不过期。
     - 2.缓存时间设置一个波动值，避免在同时间内大量的缓存失效。
     - 3.如果有多台`Redis`，可以将热点数据打散分到不同的机器当中。
     - 4.双缓存模式。数据库数据同步到缓存A和B。A设置过期时间，B不设置过期时间。当A为空时去读取B，同时异步去更新缓存，但是更新时需要同时更新2个缓存。

# 10.
   

