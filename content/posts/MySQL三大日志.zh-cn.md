---
title: "MySQL三大日志"
date: 2022-06-08T18:47:35+08:00
draft: false
author: 插画师
tags: ["MySQL"]
categories: ["Tech"]
---

# 1. 三大日志

MySQL的日志系统分为3类：

1. **redo log** ：重做日志，redolog是InnoDB存储引擎层的日志。作用是确保日志的持久性，防止在发生故障的时间点，尚有脏页未写入磁盘，在重启MySQL服务时，根据`redo log` 进行重做，从而达到事务的持久性这一特性。
2. **undo log**：回滚日志。作用是确保了事务发生之前的数据的一个版本，可以用于回滚，同时可以提供多版本并发控制的读（MVCC），也即非锁定读。
3. **bin log**：二进制日志，也叫归档日志，是MySQL Server层记录的日志。作用是用于复制，在主从复制中，从库利用主库上的 `bin log` 进行重播，实现主从同步；也用于数据库基于时间点的还原。

# 2.redo log

事务的所有修改操作（增删改），数据库都会生产一条`redo`日志记录到`redo log`。区别于`undo log`记录SQL语句，`redo log`记录的是事务对数据的哪个数据页做了什么修改，属于物理日志。 redo日志应用场景：数据系统直接崩溃，需要进行恢复，一般数据库都会使用按时间点备份的策略。首先将数据库恢复到最近备份的时间点状态，之后读取该时间点之后的`redo log`记录，重新执行相应操作，达到最终恢复的目的。

`redo log` 日志的大小是固定的，即记录满了以后就从头循环写。

# 3.bin log

- **redo log和 bin log的区别**
  1. `redo log` 是属于InnoDB层面的，`bin log` 属于MySQL Server层面的。这样在数据库用别的存储引擎时可以达到一致性的要求。
  2. `redo log`是物理日志，记录该数据页的更新内容；`bin log` 是逻辑日志，记录的是这个更新语句的原始逻辑。
  3. `redo log` 是循环写，日志空间大小固定；`bin log`是追加写，是指一份写到一定大小时会更换下一个文件，不会覆盖。
  4. `bin log`可以作为恢复数据使用，主从复制搭建；`redo log`作为异常宕机或者介质故障后的数据恢复使用。

# 4.undo log

**`InnoDB`事务日志包括`redo log` 和 `undo log` 。前者是重做日志，提供前滚操作；后者是回滚日志，提供回滚操作。**

*`undo log`不是`redo log`的逆向工程，其实两者都算是用来恢复的日志*

1. **`redo log`通常是物理日志，记录的是数据页的物理修改，而不是某一行或者某几行修改成什么样，它用来恢复提交后的物理数据页（恢复数据页，且只能恢复到最后一次提交的位置）。**
2. **`undo log`用来回滚行记录到某个版本。`undo log`一般是逻辑日志，根据每行记录进行记录。**

> 参考文章：[MySQL日志系统：redo log、binlog、undo log 区别与作用](https://blog.csdn.net/u010002184/article/details/88526708)

